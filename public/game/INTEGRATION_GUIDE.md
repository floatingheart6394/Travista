# TRAVISTA GAME INTEGRATION GUIDE
## Pokemon Hub World + Pygame Platformer

---

## ğŸ® OVERVIEW

This setup creates a **hub-and-spoke game architecture**:
- **Pokemon-style game** = Hub world (browser-based, always running)
- **Pygame platformer** = Portal destination (opens in new tab via pygbag)

**NO EMBEDDING**: Each game runs independently. The portal simply opens a new browser tab.

---

## ğŸ“ REQUIRED FOLDER STRUCTURE

```
public/game/
â”œâ”€â”€ pokemon-style-game/         # Hub world (JavaScript canvas game)
â”‚   â”œâ”€â”€ index.html              # Updated with portal UI
â”‚   â”œâ”€â”€ index.js                # Updated with portal logic
â”‚   â”œâ”€â”€ classes.js              # Sprite classes
â”‚   â”œâ”€â”€ portal.js               # NEW - Portal system
â”‚   â”œâ”€â”€ battleScene.js
â”‚   â”œâ”€â”€ img/
â”‚   â”œâ”€â”€ audio/
â”‚   â”œâ”€â”€ data/
â”‚   â””â”€â”€ js/
â”‚
â”œâ”€â”€ pygame/                      # Desktop pygame source
â”‚   â”œâ”€â”€ main.py                 # Updated for pygbag compatibility
â”‚   â””â”€â”€ assets/                 # Game assets (sprites, audio, etc.)
â”‚       â”œâ”€â”€ MainCharacters/
â”‚       â”œâ”€â”€ Background/
â”‚       â”œâ”€â”€ Terrain/
â”‚       â”œâ”€â”€ Traps/
â”‚       â”œâ”€â”€ Menu/
â”‚       â””â”€â”€ enemy/
â”‚
â””â”€â”€ pygame-web/                  # âš ï¸ GENERATED by pygbag (DO NOT CREATE MANUALLY)
    â”œâ”€â”€ index.html               # Pygame web build entry point
    â”œâ”€â”€ main.py                  # Bundled Python code
    â”œâ”€â”€ pygame.data              # Asset bundle
    â””â”€â”€ *.wasm, *.js            # WebAssembly + JS files
```

---

## ğŸ”§ SETUP STEPS

### STEP 1: Install Pygbag

```bash
pip install pygbag
```

### STEP 2: Build Pygame for Web

Navigate to the pygame directory and run:

```bash
cd public/game/pygame
python -m pygbag .
```

This creates `public/game/pygame/build/web/` containing the browser-ready game.

**Important**: You need to move/copy the contents to `public/game/pygame-web/`:

```bash
# Windows PowerShell
Move-Item -Path build\web\* -Destination ..\pygame-web\ -Force

# Or manually copy build/web/* to public/game/pygame-web/
```

### STEP 3: Verify Portal Integration

Open `public/game/pokemon-style-game/index.html` in a browser.

You should see:
- âœ… Animated portal sprite in the world
- âœ… "Press E to enter Portal" prompt when player is near
- âœ… Pressing E opens pygame game in new tab

---

## ğŸ¯ HOW IT WORKS

### Pokemon Game (Hub World)

**Portal Class** (`portal.js`):
```javascript
class Portal extends Sprite {
  activate(playerData) {
    // Save state to localStorage (optional)
    localStorage.setItem('travista_player_state', JSON.stringify(playerData))
    
    // Open pygame game in new tab
    window.open('/game/pygame-web/index.html', '_blank')
  }
}
```

**Collision Detection** (`index.js`):
```javascript
// Check if player is near portal
const playerNearPortal = checkPortalCollision({ player, portal })
showPortalPrompt(playerNearPortal)  // Show "Press E" UI

// Activate on E key press
if (e.key === 'e' && nearPortal) {
  portal.activate({ playerName: 'Traveler', score: 0 })
}
```

### Pygame Game (Platformer)

**Async Main Loop** (pygbag requirement):
```python
async def main(window):
    clock = pygame.time.Clock()
    run = True
    
    while run:
        clock.tick(FPS)
        
        # Game logic here...
        
        # âš ï¸ CRITICAL: Yield control to browser once per frame
        await asyncio.sleep(0)

# Entry point
if __name__ == "__main__":
    asyncio.run(main(window))
```

**Asset Path Fix** (browser compatibility):
```python
from os.path import dirname, abspath, join

BASE_DIR = dirname(abspath(__file__))

# All asset loads use BASE_DIR
image = pygame.image.load(join(BASE_DIR, "assets", "Background", "Yellow.png"))
```

---

## ğŸ”„ DATA FLOW (Optional)

You can pass data between games using **localStorage**:

### Pokemon â†’ Pygame
```javascript
// In portal.js
portal.activate({
  playerName: 'Ash',
  score: 1500,
  inventory: ['potion', 'pokeball']
})
```

### Pygame â†’ Pokemon
```python
# In pygame main.py (at end of game)
import js
js.localStorage.setItem('pygame_result', json.dumps({
    'platformer_score': SCORE,
    'hp_remaining': player.hp,
    'time_played': 300
}))
```

### Pokemon reads result
```javascript
// When user returns to pokemon game
const result = JSON.parse(localStorage.getItem('pygame_result') || '{}')
console.log('Player scored:', result.platformer_score)
```

---

## ğŸ¨ CUSTOMIZATION

### Portal Position
Edit `pokemon-style-game/index.js`:
```javascript
const portal = new Portal({
  position: {
    x: 200,  // Change X position
    y: 300   // Change Y position
  },
  // ...
})
```

### Portal Sprite
Replace placeholder with custom sprite:
```javascript
const portalImage = new Image()
portalImage.src = './img/portal.png'  // Use your own sprite
```

### Portal Animation
Adjust in `portal.js`:
```javascript
frames: {
  max: 8,    // Number of frames in sprite sheet
  hold: 10   // Frame duration (lower = faster)
}
```

---

## âš ï¸ TROUBLESHOOTING

### Portal doesn't appear
- Check browser console for errors
- Verify `portal.js` is loaded before `index.js` in HTML
- Confirm Portal class is defined (check `portal.js` loaded successfully)

### "Press E" prompt doesn't show
- Verify `#portalPrompt` div exists in HTML
- Check collision detection is working (add console.log in `checkPortalCollision`)

### Pygame game opens blank screen
- Verify pygbag build completed successfully
- Check browser console for asset loading errors
- Ensure all paths in `main.py` use `BASE_DIR`

### Popup blocked
- Browser may block `window.open()` - user must allow popups
- Test with popup blocker disabled
- Add user instructions to allow popups

### Assets not loading in pygame
- Verify `BASE_DIR` is set correctly
- Check all asset paths use `join(BASE_DIR, "assets", ...)`
- Ensure assets folder is in same directory as main.py

---

## ğŸš€ DEPLOYMENT NOTES

### Local Development
```bash
# Serve from project root
npx http-server -p 8000

# Open Pokemon game
http://localhost:8000/public/game/pokemon-style-game/

# Portal opens
http://localhost:8000/public/game/pygame-web/
```

### Production Build
- Upload entire `public/game/` folder to web server
- Ensure MIME types are configured for `.wasm`, `.data` files
- Test CORS settings if games are on different domains

### Vite Integration (React + Vite)
The portal system works with your existing Vite setup:
- Pokemon game lives in `public/` (static serving)
- Pygame web build lives in `public/` (static serving)
- React routes can link to `/game/pokemon-style-game/`

---

## ğŸ“ KEY FILES MODIFIED

1. **public/game/pokemon-style-game/portal.js** - NEW
   - Portal class with animation
   - Collision detection helper
   - Activation logic

2. **public/game/pokemon-style-game/index.js** - UPDATED
   - Portal instance creation
   - Portal added to movables/renderables
   - E key handler for portal activation
   - Collision check in animation loop

3. **public/game/pokemon-style-game/index.html** - UPDATED
   - Portal prompt UI div
   - Script tag for portal.js

4. **public/game/pygame/main.py** - UPDATED
   - `async def main()` function
   - `await asyncio.sleep(0)` in game loop
   - `asyncio.run(main(window))` entry point
   - BASE_DIR for relative paths
   - Removed `pygame.quit()` and `quit()`

---

## ğŸ“ DESIGN PHILOSOPHY

**Why no embedding?**
- **Simplicity**: Each game is self-contained
- **Performance**: No canvas nesting overhead
- **Debugging**: Isolated game logic
- **Flexibility**: Easy to swap games or add more portals

**Why new tab?**
- **Context switching**: Clear separation between worlds
- **Browser compatibility**: Works everywhere
- **Memory management**: Each game has own resources
- **User experience**: Easy to return to hub (close tab)

---

## ğŸ”® FUTURE ENHANCEMENTS

1. **Portal Animations**
   - Add swirl/vortex effect
   - Particle system on entry
   - Sound effects

2. **State Persistence**
   - Save game progress
   - Track portal usage
   - Achievement system

3. **Multiple Portals**
   - Create array of portals
   - Each leads to different mini-game
   - Portal unlock progression

4. **Return Portal**
   - Add "back to hub" button in pygame
   - Use `window.close()` or localStorage flag
   - Show completion message

---

## ğŸ“ SUPPORT

If issues persist:
1. Check browser console (F12) for errors
2. Verify all file paths are correct
3. Test pygame game standalone (local)
4. Test Pokemon game standalone (local)
5. Ensure pygbag build succeeded

---

**Created for Travista** | Portal system v1.0 | Prototype phase
